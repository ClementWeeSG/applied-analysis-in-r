---
title: "Blood and Wine: The Wild Hunt"
output: 
  flexdashboard::flex_dashboard:
runtime: shiny
---
  
```{r setup, include=FALSE}
library(flexdashboard)
library(leaflet)
library(readr)

# UTF fix

source.utf8 <- function(f) {
    l <- readLines(f, encoding="UTF-8")
    eval(parse(text=l),envir=.GlobalEnv)
}

# include helper

source("r/chloropleth.R")

# load data
wine_file <- read_csv("data/wine_master.utf8.csv")
wine_master <- wine_file[,c(24,26:33)]
wine_bottles <- read_csv("data/wine_betas.utf8.csv")
mapPolys <- geojsonio::geojson_read("data/countries.geo.json", what = "sp")
names(mapPolys) = c("id","country")
#mergedMap = sp::merge(mapPolys,wine_master)


```

Identify your favourite flavours >>
===============================================================
Row {data-height=50}
--------------------------
Didn't you know there are many many ways to look at wine? Explore some ways below.

Row {data-height=500 .tabset .tabset-fade}
--------------------------

### Pricing

```{r}
pricingDensity <- density(na.omit(wine_master$price), bw="sj")
plot(pricingDensity, main = "Distribution of Wine Prices")
polygon(pricingDensity, col = "blue", border="red")

```

### Variety

```{r}
```

### Review Ratings

```{r}
```

### Country
```{r}

```
Sample the relationships >> {data-orientation=rows}
===================================================

Row {data-height = 150}
------------------------

See how the different brands are related to each other

Row {.tabset, data-height = 500}
--------------------------------
### Prices for different countries

```{r}

```

### Ratings for different prices

```{r}
```

### Ratings for different varieties

```{r}
```

Locate your favourite flavours >>
=================================
Inputs {.sidebar}
---------------------------------------------------------------------

Column {.tabset .tabset-fade}
-----------------------------------------------------------------------
### Price
```{r}
wines_by_price = wine_master[, c("country","price")]
mapByPrice = aggregate(wines_by_price, list( wines_by_price$country), median, na.action = na.omit)
pal <- colorBin("Blues", domain = mapByPrice$price, bins = 5, na.color = "white")
  
leaflet(sp::merge(mapPolys,mapByPrice)) %>% addPolygons(
    fillColor = ~pal(price),
    weight = 2,
    opacity = 1,
    color = "black",
    fillOpacity = 1.0
  ) %>% addLegend(pal = pal, values = ~price, opacity = 0.7, title = NULL,
                  position = "bottomright")
```
### Topics

And now ... Drink and view the entire array!{data-orientation=columns}
======================================================================
Inputs {.sidebar}
---------------------------------------------------------------------------------
```{r}

numericInput(inputId = "labels", label = "Number of Labels", min = 50, max = nrow(wine_master), value= 500)

```

Column
--------------------------------------------------------------------------------
```{r}
renderTable({
  wine_sample <- sample(nrow(wine_master), as.integer(input$labels))
  wine_master[wine_sample,]
})

```